<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Yunoxa - Express Checkout</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Online Shopping in Sri Lanka" name="keywords">
    <meta content="Yunoxa - Best Online Shopping Platform in Sri Lanka" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/checkout.css" rel="stylesheet">
</head>

<body>
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home nav-icon"></i>
            <span>Home</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-search nav-icon"></i>
            <span>Search</span>
        </a>
        <a href="index.html" class="nav-item">
            <i class="fas fa-gift nav-icon"></i>
            <span>Deals</span>
        </a>
        <a href="cart.html" class="nav-item">
            <i class="fas fa-shopping-cart nav-icon"></i>
            <span>Cart</span>
        </a>
    </nav>

    <!-- Checkout Content -->
    <div class="checkout-container">
        <div class="checkout-header">
            <h1><i class="fas fa-lock"></i> Express Checkout</h1>
            <div class="checkout-progress">
                <div class="progress-step active" id="step-shipping">1. Shipping</div>
                <div class="progress-step" id="step-payment">2. Payment</div>
                <div class="progress-step" id="step-review">3. Review</div>
            </div>
        </div>

        <div class="checkout-body">
            <div class="checkout-main">
                <!-- Shipping Address Section -->
                <section class="checkout-section" id="shipping-section">
                    <h2><i class="fas fa-truck"></i> Shipping Address</h2>
                    <div class="address-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">First Name *</label>
                                <input type="text" id="firstName" placeholder="Enter first name" required>
                                <div class="error-message"></div>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name *</label>
                                <input type="text" id="lastName" placeholder="Enter last name" required>
                                <div class="error-message"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="address">Address *</label>
                            <input type="text" id="address" placeholder="Street address" required>
                            <div class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="address2">Address 2 (Optional)</label>
                            <input type="text" id="address2" placeholder="Apartment, suite, etc.">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">City *</label>
                                <input type="text" id="city" placeholder="Enter city" required>
                                <div class="error-message"></div>
                            </div>
                            <div class="form-group">
                                <label for="province">Province *</label>
                                <select id="province" required>
                                    <option value="">Select province</option>
                                    <option value="western">Western Province</option>
                                    <option value="central">Central Province</option>
                                    <option value="southern">Southern Province</option>
                                    <option value="northern">Northern Province</option>
                                    <option value="eastern">Eastern Province</option>
                                    <option value="nw">North Western Province</option>
                                    <option value="nc">North Central Province</option>
                                    <option value="uva">Uva Province</option>
                                    <option value="sabaragamuwa">Sabaragamuwa Province</option>
                                </select>
                                <div class="error-message"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="postalCode">Postal Code *</label>
                                <input type="text" id="postalCode" placeholder="Enter postal code" required>
                                <div class="error-message"></div>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number *</label>
                                <input type="tel" id="phone" placeholder="Enter phone number" required>
                                <div class="error-message"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Shipping Method Section -->
                <section class="checkout-section" id="shipping-method-section">
                    <h2><i class="fas fa-shipping-fast"></i> Shipping Method</h2>
                    <div class="shipping-methods">
                        <div class="shipping-method selected">
                            <div class="method-radio">
                                <input type="radio" name="shipping" id="standard" checked>
                                <label for="standard"></label>
                            </div>
                            <div class="method-info">
                                <h3>Standard Shipping</h3>
                                <p>Estimated delivery: 5-7 business days</p>
                                <p class="shipping-rate">LKR 250</p>
                            </div>
                            <div class="method-price">LKR 250</div>
                        </div>
                        <div class="shipping-method">
                            <div class="method-radio">
                                <input type="radio" name="shipping" id="express">
                                <label for="express"></label>
                            </div>
                            <div class="method-info">
                                <h3>Express Shipping</h3>
                                <p>Estimated delivery: 2-3 business days</p>
                                <p class="shipping-rate">LKR 400</p>
                            </div>
                            <div class="method-price">LKR 400</div>
                        </div>
                    </div>
                </section>

                <!-- Payment Section (initially hidden) -->
                <section class="checkout-section" id="payment-section" style="display: none;">
                    <h2><i class="fas fa-credit-card"></i> Payment Method</h2>
                    <div class="payment-methods">
                        <div class="payment-method selected">
                            <div class="method-radio">
                                <input type="radio" name="payment" id="creditCard" checked>
                                <label for="creditCard"></label>
                            </div>
                            <div class="method-info">
                                <h3>Credit/Debit Card</h3>
                                <div class="card-icons">
                                    <img src="https://cdn-icons-png.flaticon.com/512/196/196578.png" alt="Visa">
                                    <img src="https://cdn-icons-png.flaticon.com/512/196/196561.png" alt="Mastercard">
                                </div>
                            </div>
                        </div>
                        <div class="payment-method">
                            <div class="method-radio">
                                <input type="radio" name="payment" id="paypal">
                                <label for="paypal"></label>
                            </div>
                            <div class="method-info">
                                <h3>PayPal</h3>
                                <img src="https://cdn-icons-png.flaticon.com/512/174/174861.png" alt="PayPal" class="paypal-icon">
                            </div>
                        </div>
                        <div class="payment-method">
                            <div class="method-radio">
                                <input type="radio" name="payment" id="cod">
                                <label for="cod"></label>
                            </div>
                            <div class="method-info">
                                <h3>Cash on Delivery</h3>
                                <p>Pay when you receive your order</p>
                            </div>
                        </div>
                    </div>

                    <!-- Credit Card Form (shown when credit card is selected) -->
                    <div class="credit-card-form">
                        <div class="form-group">
                            <label for="cardNumber">Card Number *</label>
                            <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" required>
                            <div class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="cardName">Name on Card *</label>
                            <input type="text" id="cardName" placeholder="Enter name as it appears on card" required>
                            <div class="error-message"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expiry">Expiry Date *</label>
                                <input type="text" id="expiry" placeholder="MM/YY" required>
                                <div class="error-message"></div>
                            </div>
                            <div class="form-group">
                                <label for="cvv">CVV *</label>
                                <input type="text" id="cvv" placeholder="123" required>
                                <div class="error-message"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="checkout-actions">
                        <button class="btn-back" id="back-to-shipping"><i class="fas fa-arrow-left"></i> Back to Shipping</button>
                        <button class="btn-continue" id="continue-to-review">Continue to Review</button>
                    </div>
                </section>

                <!-- Review Section (initially hidden) -->
                <section class="checkout-section" id="review-section" style="display: none;">
                    <h2><i class="fas fa-check-circle"></i> Review Your Order</h2>
                    
                    <div class="review-section">
                        <h3><i class="fas fa-truck"></i> Shipping Information</h3>
                        <div class="review-info" id="review-shipping">
                            <!-- Dynamically filled with shipping info -->
                        </div>
                    </div>
                    
                    <div class="review-section">
                        <h3><i class="fas fa-credit-card"></i> Payment Method</h3>
                        <div class="review-info" id="review-payment">
                            <!-- Dynamically filled with payment info -->
                        </div>
                    </div>
                    
                    <div class="checkout-actions">
                        <button class="btn-back" id="back-to-payment"><i class="fas fa-arrow-left"></i> Back to Payment</button>
                        <button class="btn-confirm" id="confirm-order">Confirm Order</button>
                    </div>
                </section>

                <div class="checkout-actions" id="initial-actions">
                    <button class="btn-continue" id="continue-to-payment">Continue to Payment</button>
                </div>
            </div>

            <div class="checkout-sidebar">
                <div class="order-summary">
                    <h2><i class="fas fa-shopping-bag"></i> Order Summary</h2>
                    <div class="order-items" id="order-items-container">
                        <!-- Single product will be inserted here -->
                    </div>
                    <div class="order-totals">
                        <div class="total-row">
                            <span>Subtotal</span>
                            <span id="subtotal-amount">LKR 0.00</span>
                        </div>
                        <div class="total-row">
                            <span>Shipping</span>
                            <span id="shipping-amount">LKR 250.00</span>
                        </div>
                        <div class="total-row discount">
                            <span>Discount</span>
                            <span id="discount-amount">-LKR 0.00</span>
                        </div>
                        <div class="total-row grand-total">
                            <span>Total</span>
                            <span id="total-amount">LKR 0.00</span>
                        </div>
                    </div>
                </div>

                <div class="secure-checkout">
                    <p><i class="fas fa-lock"></i> Secure checkout</p>
                    <p><i class="fas fa-shield-alt"></i> Buyer protection</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get product from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            let product = {
                name: "Product Name",
                price: 0,
                originalPrice: 0,
                discount: "0",
                image: "https://via.placeholder.com/60",
                color: "",
                size: "",
                quantity: 1
            };

            try {
                if (urlParams.has('product')) {
                    const productParam = JSON.parse(decodeURIComponent(urlParams.get('product')));
                    product = {
                        ...product,
                        ...productParam,
                        quantity: 1 // Force quantity to 1 for Buy Now
                    };
                }
            } catch (e) {
                console.error("Error parsing product:", e);
            }

            // Calculate prices
            const discountValue = parseFloat(product.discount) || 0;
            const discountedPrice = product.price * (1 - discountValue/100);
            const subtotal = discountedPrice;
            let shippingCost = 250; // Default to standard shipping

            // Display the product
            const orderItemsContainer = document.getElementById('order-items-container');
            orderItemsContainer.innerHTML = `
                <div class="order-item">
                    <div class="item-image">
                        <img src="${product.image}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/60'">
                    </div>
                    <div class="item-details">
                        <h3>${product.name}</h3>
                        ${product.color ? `<p>Color: ${product.color}</p>` : ''}
                        ${product.size ? `<p>Size: ${product.size}</p>` : ''}
                        ${discountValue > 0 ? `<p>Discount: ${product.discount}%</p>` : ''}
                        <div class="item-price">LKR ${discountedPrice.toFixed(2)}</div>
                        <div class="item-quantity">Qty: 1</div>
                    </div>
                </div>
            `;

            // Update order totals
            document.getElementById('subtotal-amount').textContent = `LKR ${subtotal.toFixed(2)}`;
            document.getElementById('shipping-amount').textContent = `LKR ${shippingCost.toFixed(2)}`;
            
            if (discountValue > 0) {
                const discountAmount = product.price - discountedPrice;
                document.getElementById('discount-amount').textContent = `-LKR ${discountAmount.toFixed(2)}`;
            } else {
                document.querySelector('.total-row.discount').style.display = 'none';
            }
            
            updateTotal();

            // Shipping method change handler
            document.querySelectorAll('input[name="shipping"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    shippingCost = this.id === 'express' ? 400 : 250;
                    document.getElementById('shipping-amount').textContent = `LKR ${shippingCost.toFixed(2)}`;
                    updateTotal();
                });
            });

            function updateTotal() {
                const subtotal = parseFloat(document.getElementById('subtotal-amount').textContent.replace('LKR ', ''));
                const total = subtotal + shippingCost;
                document.getElementById('total-amount').textContent = `LKR ${total.toFixed(2)}`;
            }

            // [Rest of your existing JavaScript for form navigation and validation]
            // ... (include all the form navigation and validation code from your original)
        });

        document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const continueToPaymentBtn = document.getElementById('continue-to-payment');
    const continueToReviewBtn = document.getElementById('continue-to-review');
    const confirmOrderBtn = document.getElementById('confirm-order');
    const backToShippingBtn = document.getElementById('back-to-shipping');
    const backToPaymentBtn = document.getElementById('back-to-payment');
    
    const shippingSection = document.getElementById('shipping-section');
    const shippingMethodSection = document.getElementById('shipping-method-section');
    const paymentSection = document.getElementById('payment-section');
    const reviewSection = document.getElementById('review-section');
    const initialActions = document.getElementById('initial-actions');
    
    const stepShipping = document.getElementById('step-shipping');
    const stepPayment = document.getElementById('step-payment');
    const stepReview = document.getElementById('step-review');
    
    // Calculate shipping cost based on method and number of items
    function calculateShippingCost(shippingMethod, itemCount) {
        if (shippingMethod === 'express') {
            return 400 * itemCount; // LKR 400 per product for express
        } else {
            return 250 * itemCount; // LKR 250 per product for standard
        }
    }

    // Update order summary with cart items and totals
    function updateOrderSummary() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const orderItemsContainer = document.querySelector('.order-items');
        const subtotalElement = document.querySelector('.total-row span:last-child');
        const shippingElement = document.querySelector('.total-row:nth-child(2) span:last-child');
        const discountElement = document.querySelector('.total-row.discount span:last-child');
        const totalElement = document.querySelector('.total-row.grand-total span:last-child');
        
        // Get selected shipping method
        const shippingMethod = document.querySelector('input[name="shipping"]:checked')?.id || 'standard';
        const shippingCost = calculateShippingCost(shippingMethod, cart.reduce((total, item) => total + item.quantity, 0));
        
        // Calculate totals
        let subtotal = 0;
        let totalDiscount = 0;
        
        orderItemsContainer.innerHTML = cart.map(item => {
            const itemTotal = item.price * item.quantity;
            subtotal += itemTotal;
            const itemDiscount = (item.originalPrice - item.price) * item.quantity;
            totalDiscount += itemDiscount;
            
            return `
                <div class="order-item">
                    <div class="item-image">
                        <img src="${item.image}" alt="${item.name}">
                    </div>
                    <div class="item-details">
                        <h3>${item.name}</h3>
                        ${item.discount && item.discount !== "0" ? `<p>Discount: ${item.discount}%</p>` : ''}
                        <div class="item-price">LKR ${itemTotal.toFixed(2)}</div>
                        <div class="item-quantity">Qty: ${item.quantity}</div>
                    </div>
                </div>
            `;
        }).join('');
        
        // Update totals
        subtotalElement.textContent = `LKR ${subtotal.toFixed(2)}`;
        shippingElement.textContent = shippingCost === 0 ? 'FREE' : `LKR ${shippingCost.toFixed(2)}`;
        
        if (totalDiscount > 0) {
            discountElement.textContent = `-LKR ${totalDiscount.toFixed(2)}`;
            discountElement.parentElement.style.display = 'flex';
        } else {
            discountElement.parentElement.style.display = 'none';
        }
        
        const total = subtotal + shippingCost;
        totalElement.textContent = `LKR ${total.toFixed(2)}`;
        
        // Update shipping method prices
        document.querySelectorAll('.method-price').forEach(el => {
            const methodId = el.closest('.shipping-method').querySelector('input').id;
            const itemCount = cart.reduce((total, item) => total + item.quantity, 0);
            const cost = calculateShippingCost(methodId, itemCount);
            el.textContent = cost === 0 ? 'FREE' : `LKR ${cost.toFixed(2)}`;
        });
    }

    // Form validation function
    function validateShippingForm() {
        let isValid = true;
        const requiredFields = [
            'firstName', 'lastName', 'address', 
            'city', 'province', 'postalCode', 'phone'
        ];
        
        requiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            const errorMsg = field.parentElement.querySelector('.error-message');
            
            if (!field.value.trim()) {
                errorMsg.textContent = 'This field is required';
                isValid = false;
            } else {
                errorMsg.textContent = '';
            }
        });
        
        return isValid;
    }
    
    // Function to update review sections with entered information
    function updateReviewSections() {
        // Shipping info
        const shippingInfo = `
            <p>${document.getElementById('firstName').value} ${document.getElementById('lastName').value}</p>
            <p>${document.getElementById('address').value}</p>
            ${document.getElementById('address2').value ? `<p>${document.getElementById('address2').value}</p>` : ''}
            <p>${document.getElementById('city').value}, ${document.getElementById('province').value}</p>
            <p>${document.getElementById('postalCode').value}</p>
            <p>Phone: ${document.getElementById('phone').value}</p>
            <p>Shipping Method: ${document.querySelector('input[name="shipping"]:checked + label').parentElement.parentElement.querySelector('h3').textContent}</p>
        `;
        document.getElementById('review-shipping').innerHTML = shippingInfo;
        
        // Payment info
        const paymentMethod = document.querySelector('input[name="payment"]:checked').id;
        let paymentInfo = '';
        
        if (paymentMethod === 'creditCard') {
            paymentInfo = `
                <p>Credit Card ending in ${document.getElementById('cardNumber').value.slice(-4)}</p>
                <p>Expires: ${document.getElementById('expiry').value}</p>
            `;
        } else if (paymentMethod === 'paypal') {
            paymentInfo = `<p>PayPal</p>`;
        } else {
            paymentInfo = `<p>Cash on Delivery</p>`;
        }
        
        document.getElementById('review-payment').innerHTML = paymentInfo;
    }
    
    // Initialize the order summary
    updateOrderSummary();
    
    // Handle shipping method selection
    const shippingMethods = document.querySelectorAll('.shipping-method');
    shippingMethods.forEach(method => {
        method.addEventListener('click', function() {
            shippingMethods.forEach(m => m.classList.remove('selected'));
            this.classList.add('selected');
            this.querySelector('input').checked = true;
            updateOrderSummary();
        });
    });

    // Handle payment method selection
    const paymentMethods = document.querySelectorAll('.payment-method');
    paymentMethods.forEach(method => {
        method.addEventListener('click', function() {
            paymentMethods.forEach(m => m.classList.remove('selected'));
            this.classList.add('selected');
            this.querySelector('input').checked = true;
        });
    });

    // Continue to Payment Button
    continueToPaymentBtn.addEventListener('click', function(e) {
        e.preventDefault();
        
        if (validateShippingForm()) {
            // Hide shipping sections
            shippingSection.style.display = 'none';
            shippingMethodSection.style.display = 'none';
            initialActions.style.display = 'none';
            
            // Show payment section
            paymentSection.style.display = 'block';
            
            // Update progress steps
            stepShipping.classList.remove('active');
            stepPayment.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
    });
    
    // Back to Shipping Button
    backToShippingBtn.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Show shipping sections
        shippingSection.style.display = 'block';
        shippingMethodSection.style.display = 'block';
        initialActions.style.display = 'flex';
        
        // Hide payment section
        paymentSection.style.display = 'none';
        
        // Update progress steps
        stepPayment.classList.remove('active');
        stepShipping.classList.add('active');
        
        // Scroll to top
        window.scrollTo(0, 0);
    });
    
    // Continue to Review Button
    continueToReviewBtn.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Validate payment form if credit card is selected
        const paymentMethod = document.querySelector('input[name="payment"]:checked').id;
        
        if (paymentMethod === 'creditCard') {
            let isValid = true;
            const requiredFields = ['cardNumber', 'cardName', 'expiry', 'cvv'];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                const errorMsg = field.parentElement.querySelector('.error-message');
                
                if (!field.value.trim()) {
                    errorMsg.textContent = 'This field is required';
                    isValid = false;
                } else {
                    errorMsg.textContent = '';
                }
            });
            
            if (!isValid) return;
        }
        
        // Update review sections with entered information
        updateReviewSections();
        
        // Hide payment section
        paymentSection.style.display = 'none';
        
        // Show review section
        reviewSection.style.display = 'block';
        
        // Update progress steps
        stepPayment.classList.remove('active');
        stepReview.classList.add('active');
        
        // Scroll to top
        window.scrollTo(0, 0);
    });
    
    // Back to Payment Button
    backToPaymentBtn.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Show payment section
        paymentSection.style.display = 'block';
        
        // Hide review section
        reviewSection.style.display = 'none';
        
        // Update progress steps
        stepReview.classList.remove('active');
        stepPayment.classList.add('active');
        
        // Scroll to top
        window.scrollTo(0, 0);
    });
    
    // Confirm Order Button
    confirmOrderBtn.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Show loading state
        confirmOrderBtn.disabled = true;
        confirmOrderBtn.innerHTML = 'Processing... <i class="fas fa-spinner fa-spin"></i>';
        
        // Simulate order processing
        setTimeout(function() {
            alert('Order confirmed! Thank you for your purchase.');
            
            // Clear cart after successful order
            localStorage.removeItem('cart');
            
            // Redirect to order confirmation page
            window.location.href = 'order-confirmation.html';
        }, 1500);
    });
});
    </script>
</body>
</html>